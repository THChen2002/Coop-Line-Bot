{% extends "base.html" %}

{% block title %}è¨˜å¸³è¡¨å–®{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/expense_form.css') }}">
{% endblock %}

{% block content %}
<div class="container">
  <div class="card">
    <h1>ğŸ’° è¨˜å¸³è¡¨å–®</h1>
    <p class="subtitle">è¼•é¬†è¨˜éŒ„æ¯ä¸€ç­†æ”¯å‡º</p>

    <form id="expenseForm">
      <div class="form-group">
        <label for="description">é …ç›®åç¨± *</label>
        <input type="text" id="description" placeholder="ä¾‹å¦‚ï¼šåˆé¤ã€è¨ˆç¨‹è»Š" required>
      </div>

      <div class="form-group">
        <label for="amount">ç¸½é‡‘é¡ *</label>
        <input type="number" id="amount" placeholder="0" min="1" step="1" required>
      </div>

      <div class="form-group">
        <label for="payer">ä»˜æ¬¾äºº *</label>
        <select id="payer" required>
          <option value="">è«‹é¸æ“‡ä»˜æ¬¾äºº</option>
          {% for member in members %}
          <option value="{{ member.id }}">{{ member.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label>åˆ†å¸³æ–¹å¼</label>
        <div class="split-type-buttons">
          <button type="button" class="split-type-btn active" data-type="equal">å¹³å‡åˆ†å¸³</button>
          <button type="button" class="split-type-btn" data-type="custom">è‡ªè¨‚é‡‘é¡</button>
        </div>
      </div>

      <div class="form-group">
        <label>åˆ†å¸³æˆå“¡</label>
        <div id="membersList">
          {% for member in members %}
          <div class="member-item">
            <input type="checkbox" id="member_{{ member.id }}" value="{{ member.id }}" data-name="{{ member.name }}"
              checked>
            <img src="{{ member.picture_url }}" alt="{{ member.name }}" class="member-avatar">
            <span class="member-name">{{ member.name }}</span>
            <input type="number" class="member-amount" id="amount_{{ member.id }}" placeholder="0" min="0" step="1"
              disabled>
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="total-amount" id="totalCheck" style="display: none;">
        <div class="label">å·²åˆ†é…é‡‘é¡</div>
        <div class="value" id="allocatedAmount">NT$ 0</div>
      </div>

      <button type="submit" class="btn btn-primary btn-block">ç¢ºèªé€å‡º</button>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/expense_form.js') }}"></script>
<script>
  window.GROUP_ID = '{{ group_id }}';
  window.onload = function () {
    initExpenseForm('{{ liff_id }}');
  };
</script>
{% endblock %}